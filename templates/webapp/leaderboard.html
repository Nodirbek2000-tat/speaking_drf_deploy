{% extends 'webapp/base.html' %}
{% block title %}Leaderboard â€” Speaking Bot{% endblock %}

{% block content %}
<div class="safe-bottom overflow-y-auto">
  <!-- Header -->
  <div class="safe-top px-5 pb-3">
    <h1 class="text-xl font-bold text-white">Leaderboard</h1>
    <p class="text-xs text-slate-400">Top 20 most active speakers</p>
  </div>

  <!-- My Rank Banner -->
  {% if my_rank %}
  <div class="mx-4 mb-4 card p-4 flex items-center gap-3" style="background:rgba(99,102,241,0.1);border-color:rgba(99,102,241,0.25)">
    <div class="w-10 h-10 rounded-xl bg-brand/20 flex items-center justify-center text-lg font-black text-brand">#{{ my_rank }}</div>
    <div>
      <div class="text-sm font-semibold text-white">Your Rank</div>
      <div class="text-xs text-slate-400">Keep talking to climb higher!</div>
    </div>
    <svg class="w-5 h-5 text-brand ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
  </div>
  {% endif %}

  <div class="px-4 space-y-2 pb-4">
    {% for entry in board %}
    <div class="card p-4 flex items-center gap-3 {% if entry.is_me %}border-brand/30{% endif %}"
         {% if entry.is_me %}style="background:rgba(99,102,241,0.05);border-color:rgba(99,102,241,0.3)"{% endif %}>

      <!-- Rank -->
      <div class="w-9 h-9 rounded-xl flex items-center justify-center flex-shrink-0 text-lg font-black
        {% if entry.rank == 1 %}text-yellow-400{% elif entry.rank == 2 %}text-slate-300{% elif entry.rank == 3 %}text-amber-600{% else %}text-slate-500{% endif %}"
        style="{% if entry.rank <= 3 %}background:rgba(255,255,255,0.05){% else %}{% endif %}">
        {% if entry.rank == 1 %}ğŸ¥‡
        {% elif entry.rank == 2 %}ğŸ¥ˆ
        {% elif entry.rank == 3 %}ğŸ¥‰
        {% else %}{{ entry.rank }}{% endif %}
      </div>

      <!-- Avatar -->
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center text-sm font-bold text-white flex-shrink-0">
        {{ entry.name|first|upper }}
      </div>

      <!-- Info -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-1.5">
          <span class="text-sm font-semibold text-white truncate">{{ entry.name }}</span>
          {% if entry.is_me %}<span class="text-xs text-brand font-medium">(You)</span>{% endif %}
          {% if entry.is_premium %}<span class="text-xs text-gold">ğŸ‘‘</span>{% endif %}
        </div>
        <div class="flex items-center gap-2 mt-0.5">
          <span class="text-xs text-slate-400">{{ entry.total_rooms }} conversations</span>
          {% if entry.rating_count > 0 %}
          <span class="text-slate-600">Â·</span>
          <div class="flex items-center gap-0.5">
            <span class="text-xs text-gold">â˜…</span>
            <span class="text-xs text-slate-300 font-medium">{{ entry.avg_rating }}</span>
            <span class="text-xs text-slate-500">({{ entry.rating_count }})</span>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Score bar -->
      {% if board.0.total_rooms > 0 %}
      <div class="w-16 h-1.5 bg-dark-700 rounded-full overflow-hidden" style="background:#242430">
        <div class="h-full rounded-full {% if entry.rank == 1 %}bg-yellow-400{% elif entry.is_me %}bg-brand{% else %}bg-slate-500{% endif %}"
             style="width: {% widthratio entry.total_rooms board.0.total_rooms 100 %}%"></div>
      </div>
      {% endif %}
    </div>
    {% empty %}
    <div class="flex flex-col items-center justify-center py-16 text-center">
      <div class="text-6xl mb-4">ğŸ†</div>
      <p class="text-lg font-semibold text-white mb-2">No rankings yet</p>
      <p class="text-sm text-slate-400">Start talking to appear on the leaderboard!</p>
      <a href="/webapp/speaking/" class="btn-primary mt-6" style="width:auto;padding:12px 24px">Start Speaking</a>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.querySelectorAll('.nav-item').forEach(el => {
  if (el.getAttribute('href') === '/webapp/leaderboard/') el.classList.add('active');
});
</script>
{% endblock %}
