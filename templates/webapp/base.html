<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0f0f13">
<title>{% block title %}Speaking Bot{% endblock %}</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        dark: { DEFAULT: '#0f0f13', 800: '#1a1a22', 700: '#242430', 600: '#2e2e3e' },
        brand: { DEFAULT: '#6366f1', light: '#818cf8', dark: '#4f46e5' },
        gold: { DEFAULT: '#f59e0b', light: '#fbbf24' },
        success: '#10b981',
        danger: '#ef4444',
      }
    }
  }
}
</script>
<style>
  * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
  body { background: #0f0f13; color: #f1f5f9; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; overscroll-behavior: none; }
  .safe-bottom { padding-bottom: calc(72px + env(safe-area-inset-bottom, 0px)); }
  .safe-top { padding-top: calc(16px + env(safe-area-inset-top, 0px)); }
  ::-webkit-scrollbar { width: 0; }
  .card { background: #1a1a22; border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); }
  .btn-primary { background: #6366f1; color: white; border-radius: 14px; padding: 14px 24px; font-weight: 600; font-size: 15px; transition: all 0.15s; border: none; cursor: pointer; width: 100%; display: block; text-align: center; }
  .btn-primary:active { transform: scale(0.97); background: #4f46e5; }
  .btn-secondary { background: #242430; color: #f1f5f9; border-radius: 14px; padding: 14px 24px; font-weight: 600; font-size: 15px; transition: all 0.15s; border: 1px solid rgba(255,255,255,0.08); cursor: pointer; width: 100%; display: block; text-align: center; }
  .btn-secondary:active { transform: scale(0.97); }
  .btn-danger { background: #ef4444; color: white; border-radius: 14px; padding: 14px 24px; font-weight: 600; font-size: 15px; border: none; cursor: pointer; transition: all 0.15s; }
  .btn-danger:active { transform: scale(0.97); }
  .star-filled { color: #f59e0b; }
  .star-empty { color: #374151; }
  .badge-premium { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 20px; padding: 3px 10px; font-size: 11px; font-weight: 700; }
  .badge-easy { background: rgba(16,185,129,0.15); color: #10b981; border-radius: 20px; padding: 2px 8px; font-size: 11px; font-weight: 600; }
  .badge-medium { background: rgba(245,158,11,0.15); color: #f59e0b; border-radius: 20px; padding: 2px 8px; font-size: 11px; font-weight: 600; }
  .badge-hard { background: rgba(239,68,68,0.15); color: #ef4444; border-radius: 20px; padding: 2px 8px; font-size: 11px; font-weight: 600; }
  .spin { animation: spin 0.9s linear infinite; }
  @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
  .slide-up { animation: slideUp 0.3s ease; }
  @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
  .pulse-dot { animation: pulseDot 1.4s ease-in-out infinite; }
  @keyframes pulseDot { 0%,100%{transform:scale(1);opacity:1} 50%{transform:scale(1.3);opacity:0.7} }
  .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15,15,19,0.97); backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.07); padding-bottom: env(safe-area-inset-bottom, 0px); z-index: 50; }
  .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px; padding: 10px 0; flex: 1; cursor: pointer; color: #4b5563; transition: color 0.2s; text-decoration: none; }
  .nav-item.active { color: #6366f1; }
  .nav-item svg { width: 22px; height: 22px; }
  .nav-item span { font-size: 10px; font-weight: 500; letter-spacing: 0.02em; }
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 100; display: flex; align-items: flex-end; }
  .modal-sheet { background: #1a1a22; border-radius: 24px 24px 0 0; padding: 8px 20px calc(24px + env(safe-area-inset-bottom,0px)); width: 100%; max-height: 92vh; overflow-y: auto; }
  .modal-handle { width: 40px; height: 4px; background: rgba(255,255,255,0.15); border-radius: 2px; margin: 12px auto 20px; }
  .option-btn { display: flex; align-items: center; gap-3; padding: 14px; border-radius: 14px; border: 1.5px solid rgba(255,255,255,0.08); background: #242430; cursor: pointer; transition: all 0.15s; width: 100%; text-align: left; color: #f1f5f9; }
  .option-btn.selected { border-color: #6366f1; background: rgba(99,102,241,0.1); }
  .option-btn:active { transform: scale(0.98); }
  .section-title { font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; }
</style>
{% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen">

{% block content %}{% endblock %}

{% block bottom_nav %}
<nav class="bottom-nav">
  <div class="flex">
    <a href="/webapp/home/" class="nav-item {% if active_page == 'home' %}active{% endif %}" onclick="return checkNavigation(this)">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
      <span>Home</span>
    </a>
    <a href="/webapp/speaking/" class="nav-item {% if active_page == 'speaking' %}active{% endif %}" onclick="return checkNavigation(this)">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
      <span>Speaking</span>
    </a>
    <a href="/webapp/practice/" class="nav-item {% if active_page == 'practice' %}active{% endif %}" onclick="return checkNavigation(this)">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
      <span>Practice</span>
    </a>
    <a href="/webapp/leaderboard/" class="nav-item {% if active_page == 'leaderboard' %}active{% endif %}" onclick="return checkNavigation(this)">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
      <span>Leaderboard</span>
    </a>
    <a href="/webapp/premium/" class="nav-item {% if active_page == 'premium' %}active{% endif %}" onclick="return checkNavigation(this)">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
      <span>Premium</span>
    </a>
  </div>
</nav>
{% endblock %}

<script>
if (window.Telegram && window.Telegram.WebApp) {
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
  Telegram.WebApp.setHeaderColor('#0f0f13');
  Telegram.WebApp.setBackgroundColor('#0f0f13');
}

window._inCall = false;
window._inPractice = false;

function checkNavigation(el) {
  if (window._inCall) {
    if (confirm('A call is in progress. Are you sure you want to leave?')) {
      window._inCall = false; return true;
    }
    return false;
  }
  if (window._inPractice) {
    if (confirm('Practice session is in progress. Are you sure you want to leave?')) {
      window._inPractice = false; return true;
    }
    return false;
  }
  return true;
}

function formatTime(s) {
  const m = Math.floor(s / 60), ss = s % 60;
  return `${m}:${ss.toString().padStart(2, '0')}`;
}

function showToast(msg, type = 'info') {
  const colors = { info: '#6366f1', success: '#10b981', error: '#ef4444' };
  const el = document.createElement('div');
  el.style.cssText = `position:fixed;top:24px;left:50%;transform:translateX(-50%);background:${colors[type]||colors.info};color:white;padding:10px 20px;border-radius:20px;font-size:14px;font-weight:500;z-index:9999;animation:slideUp 0.3s ease;max-width:80vw;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.4)`;
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2800);
}

function getCsrf() {
  return document.cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith('csrftoken='))?.split('=')[1]||'';
}
</script>
{% block extra_scripts %}{% endblock %}
</body>
</html>
